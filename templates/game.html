<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>HANGMAN | {{ username }}</title>
</head>
<body>
    <h1>Hi {{ username }}</h1>
    <a href="/{{ username }}/scores">Scores</a>
    <button id="generate" value="{{ username }}">Generate Word!</button>
    
    <div id="word-request">
        {% block word %}
        {% endblock %}
    </div>
    <form method="" id="guess-form">
        <input type="text" placeholder="Guess a letter" id="guess-letter" name="guess" value=""></input>
        <button type ="button" id="guess-button" value="{{ username }}">Guess!</button>
    </form>
    <div id="guess-request">
        {% block guess %}
        {% endblock %}
    </div>
    
</body>
<script>
    addEventListener("DOMContentLoaded", function() {
        
        const generate = document.getElementById("generate");
        const guessButton = document.getElementById("guess-button");
        const guessForm = document.getElementById("guess-form");
        let guessInput = document.getElementById("guess-letter").value;
        const username = document.getElementById("generate").value;
        //let data = guessInput;

        const getRequest = (url) => {

            return new Promise((resolve, reject) => {

                const xhr = new XMLHttpRequest();

                xhr.open("GET",url, true)
                xhr.responseType = "text";
                xhr.onload = function() {
            
                    if (xhr.readyState == 4 && xhr.status == 200) { 
                        //template(JSON.parse(this.responseText));
                        const response = xhr.responseText;
                        resolve(response)
                        console.log(xhr.responseText);
                    } else {
                        const error = xhr.responseText;
                        reject(error)
                    }
                };
                
                xhr.send()  
            })
        }
        
        const postRequest = (url) => {

            return new Promise((resolve, reject) => {

                const xhr = new XMLHttpRequest();
                let data = document.getElementById("guess-letter").value;
                xhr.open("POST", url, true)
                xhr.setRequestHeader("Content-type","application/x-www-form-urlencoded")
                xhr.responseType = "text";
                xhr.onload = function() {
            
                    if (xhr.readyState == 4 && xhr.status == 200) { 
                        //template(JSON.parse(this.responseText));
                        const response = xhr.responseText;
                        const sent_letter = data;
                        resolve(response, sent_letter)
                        console.log(xhr.responseText);
                    } else {
                        const error = xhr.responseText;
                        reject(error)
                    }
                };
                
                xhr.send(data)
                console.log(data);
            })

        }

        generate.addEventListener("click", function() {
            
            getRequest(`/${username}/word`)
                .then((response) => {
                    document.getElementById("word-request").innerHTML = response;
                })
                .catch((error) => {

                    console.log(`Could not get file ${error}`)
                })
            
                
    });

      

        guessButton.addEventListener("click", function() {
            //data.preventDefault();
            postRequest(`/${username}/${data}`)
                .then((response, sent_letter) => {
                    
                    console.log(`successful post of ${response} ${sent_letter}`)

                })
                .catch((error) => {

                    console.log(`unsuccessful post ${error}`)

                })
        
    });
    
});

</script>
</html>

